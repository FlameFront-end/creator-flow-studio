# Архитектурный обзор `app/client`

Дата: 2026-02-25

## Что проверено
- Структура слоев `app / features / shared`.
- Границы модулей и связность между feature-модулями.
- Консистентность кэша React Query.
- Консистентность импортов и UI-слоя.
- Базовые guard-rails (eslint) для архитектуры.

## Найденные проблемы

### 1) Неконсистентность стратегии импортов (alias vs относительные пути)
Alias настроены, но используются точечно.

- Alias объявлены: `tsconfig.app.json:14`
- Относительных импортов существенно больше (грубая оценка: ~201), alias-импортов заметно меньше (~11).

Риск:
- Хрупкие импорты при перемещении файлов, ухудшение читаемости.

Рекомендация:
- Принять единый стандарт:
  - для cross-feature/shared импортов использовать alias (`@/...`),
  - относительные пути оставить только внутри одной директории/модуля.

### 2) Feature-стили вынесены в глобальную папку `src/styles` вместо колокации
Файлы типа `prompt-studio.css`, `ideas-lab.css`, `error-about.css`, `asset-viewer-post.css` подключаются глобально через `index.css`.

- `src/index.css:5`
- `src/index.css:6`
- `src/index.css:7`
- `src/index.css:8`

Риск:
- Глобальный CSS-слой разрастается и повышает риск побочных эффектов между фичами.
- Изменения в одной фиче становятся менее локальными.

Рекомендация:
- Колоцировать стили рядом с фичами (`features/*/styles`) или перейти на CSS Modules/atomic подход для ограничения области действия.

### 3) Доменные типы тянутся напрямую из API-слоя (DTO как domain model)
Фичи импортируют типы прямо из `shared/api/services/*.api.ts`.

Примеры:
- `src/features/projects/ProjectsPage.tsx:3`
- `src/features/prompt-studio/promptStudio.constants.ts:1`
- `src/features/post-drafts/components/PostDraftExportHero.tsx:7`

Риск:
- UI/домен жестко привязан к транспортным контрактам API.
- Любые изменения ответа backend требуют каскадных правок в feature-слоях.

Рекомендация:
- Ввести слой доменных моделей (`shared/model`/`entities`) и маппинг `DTO -> domain`.

## Дополнительно (качество кода)
- Найден и исправлен артефакт битой кодировки в тексте:
  - `src/features/post-drafts/PostDraftExportPage.tsx:78`
  - было: `Р’ черновике...`
  - стало: `В черновике...`

## Приоритетный план исправлений
1. Стабилизировать boundaries: вынести общие компоненты из feature-зон, ввести публичные API модулей.
2. Разбить крупные контроллеры/компоненты на меньшие единицы.

## Рекомендованная схема расположения стилей

### Целевая структура
- `src/app/styles/`:
  - только глобальные слои: reset/base/tokens/theme.
- `src/features/<feature>/styles/`:
  - стили конкретной фичи (`prompt-studio`, `ideas-lab`, `post-drafts`, `about`, `error`).
- `src/shared/components/**`:
  - локальные стили общих UI-компонентов (или CSS Modules рядом с компонентом).

### Правило импорта
- `src/main.tsx` или `src/app/App.tsx` импортирует только:
  - `app/styles/tokens.css`
  - `app/styles/base.css`
- feature-стили подключаются внутри entry-компонента фичи (например, `PromptStudioPage.tsx`), а не через глобальный `index.css`.

### Что это даст
- Локальность изменений: правки стилей фичи не влияют на весь проект.
- Меньше каскадных конфликтов и переопределений.
- Проще рефакторить и удалять фичи вместе с их стилями.
