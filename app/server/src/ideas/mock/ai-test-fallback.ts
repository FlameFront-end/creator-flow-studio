import { IdeaFormat } from '../entities/idea.entity';

type MockIdeaSeed = {
  topic: string;
  hook: string;
};

const IDEA_SEEDS: MockIdeaSeed[] = [
  {
    topic: '3 формулы хука, которые удерживают внимание в первые 2 секунды',
    hook: 'Используй структуру: шок-фраза -> доказательство в кадре -> обещание результата',
  },
  {
    topic: 'Как снять качественные перебивки на телефон',
    hook: 'Покажи сравнение: тряска против стабильного кадра и 3 быстрых правки',
  },
  {
    topic: 'Шаблон рилс на 20 секунд для экспертного контента',
    hook: 'Начни с боли аудитории и закрой ее в 3 шага',
  },
  {
    topic: 'Почему короткие ролики пролистывают и как это исправить',
    hook: 'Убери длинное вступление и сразу покажи действие в первом кадре',
  },
  {
    topic: 'Световая схема, которая делает видео визуально дороже',
    hook: 'Один ключевой свет, один практический источник и контроль фона',
  },
  {
    topic: 'Ритм монтажа для динамичных рилс',
    hook: 'Делай склейки каждые 0.7-1.2 секунды и привязывай их к акцентам речи',
  },
];

const SCRIPT_SEEDS: string[] = [
  'Открой ролик сильным тезисом, покажи короткое визуальное доказательство, затем дай 3 шага и призыв сохранить видео.',
  'Начни с частой ошибки, покажи исправление в реальном времени и заверши чеклистом действий.',
  'Сделай визуальный разрыв шаблона в первой секунде, затем дай одну рабочую схему и мини-пример применения.',
  'Сначала озвучь результат, потом подкрепи 2-3 примерами и заверши четким следующим шагом.',
];

const SHOT_SEEDS: string[][] = [
  [
    'Хук в первом кадре с крупным заголовком',
    'Проблемный пример',
    'Шаг 1 на экране',
    'Шаг 2 крупным планом',
    'Шаг 3 со сравнением до/после',
    'Призыв: сохранить и отправить коллеге',
  ],
  [
    'Короткий тезис в камеру',
    'Быстрый перебивочный монтаж',
    'Кадр с формулой/схемой',
    'Практический пример',
    'Итоговая карточка',
    'Призыв в комментарии',
  ],
  [
    'Плохой пример',
    'Хороший пример',
    'Почему это работает',
    'Советы по применению',
    'Финальный чеклист',
  ],
];

const CAPTION_SEEDS: Array<{ text: string; hashtags: string[] }> = [
  {
    text: 'Сохрани этот шаблон и примени в следующем ролике. Минимум усилий, заметный рост удержания.',
    hashtags: ['#рилс', '#контент', '#видеомаркетинг', '#smm'],
  },
  {
    text: 'Короткие видео работают лучше, когда первый кадр сразу дает конкретику. Протести сегодня.',
    hashtags: ['#шортс', '#хук', '#контентплан', '#креатор'],
  },
  {
    text: 'Если контент хороший, а метрики плоские, скорее всего проседает открывающий кадр.',
    hashtags: ['#стратегияконтента', '#рилс', '#маркетинг', '#рост'],
  },
  {
    text: 'Дорогая техника не обязательна. Нужны структура, ритм и сильное визуальное обещание.',
    hashtags: ['#видеосъемка', '#монтаж', '#мобильнаясъемка', '#ugc'],
  },
];

const IMAGE_PROMPT_SEEDS: string[] = [
  'Вертикальный кадр: рабочее место креатора, смартфон на штативе, мягкий ключевой свет, лампа на фоне, реалистичные детали, малая глубина резкости, киношная цветокоррекция',
  'Вертикальный крупный план блокнота с формулой хука, рука с маркером, боковой естественный свет, современный стол, высокая детализация, реалистичная фактура',
  'Вертикальная сцена с перебивками: клавиатура, свечение монитора, руки креатора в кадре, контрастный свет, композиция под соцсети',
  'Вертикальный разговорный сетап, минималистичный студийный фон, контролируемые блики, четкий свет по лицу, премиальный реалистичный стиль',
];

const VIDEO_PROMPT_SEEDS: string[] = [
  'Вертикальное видео 9:16, динамичный handheld с мягкой стабилизацией, плавный push-in, акцент на жесты и мимику, мягкий контровой свет, реалистичная цветокоррекция, естественный motion blur',
  'Вертикальная сцена 9:16 с чередованием крупных и средних планов, монтаж в ритме речи, легкие whip-pan переходы, детальная фактура кожи и одежды, кинематографичный контраст',
  'Вертикальный talking-head сетап 9:16, чистый фон, мягкий ключевой свет + practical light, плавные camera moves, четкая фокусировка на лице, реалистичный премиальный стиль',
  'Вертикальный b-roll 9:16 рабочего процесса креатора, быстрые перебивки, крупные планы рук и экрана, динамичные ракурсы, контролируемые блики, высокодетализированная картинка',
];

const randomItem = <T>(items: T[]): T => {
  if (!items.length) {
    throw new Error('Mock seed list is empty');
  }
  const index = Math.floor(Math.random() * items.length);
  return items[index];
};

export const buildMockIdeas = (
  count: number,
  format: string,
): Array<{ topic: string; hook: string; format: IdeaFormat }> => {
  const normalizedCount = Math.max(1, Math.floor(count));
  const normalizedFormat = toIdeaFormat(format);
  return Array.from({ length: normalizedCount }).map(() => {
    const seed = randomItem(IDEA_SEEDS);
    return {
      topic: seed.topic,
      hook: seed.hook,
      format: normalizedFormat,
    };
  });
};

export const buildMockScript = (): { text: string; shotList: string[] } => ({
  text: randomItem(SCRIPT_SEEDS),
  shotList: randomItem(SHOT_SEEDS),
});

export const buildMockCaption = (): { text: string; hashtags: string[] } =>
  randomItem(CAPTION_SEEDS);

export const buildMockImagePrompt = (): string =>
  randomItem(IMAGE_PROMPT_SEEDS);

export const buildMockVideoPrompt = (): string =>
  randomItem(VIDEO_PROMPT_SEEDS);

const toIdeaFormat = (format: string): IdeaFormat => {
  const normalized = format.trim().toLowerCase();
  if (normalized === 'short') return IdeaFormat.SHORT;
  if (normalized === 'tiktok') return IdeaFormat.TIKTOK;
  return IdeaFormat.REEL;
};
